<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø§Ù„Ù…ØµØ­Ù Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ</title>
  <style>
    body { 
      font-family: 'Amiri', serif; 
      background: #fdfcf7; 
      margin: 30px; 
      line-height: 2.5; 
      font-size: 22px;
      color: #222;
    }
    .verse {
      margin-bottom: 15px;
      text-align: justify;
    }
    .ayah-num {
      color: #666;
      font-size: 18px;
      margin: 0 4px;
    }
    .word {
      cursor: pointer;
      padding: 2px 4px;
      border-radius: 4px;
    }
    .word:hover {
      background: #e8f3ff;
    }
    .tooltip {
      position: absolute;
      background: #fff;
      border: 1px solid #ccc;
      padding: 8px;
      display: none;
      z-index: 1000;
      max-width: 300px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      font-size: 18px;
    }
    select {
      font-size: 18px;
      padding: 5px 10px;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>

<h2>ğŸ“– Ø§Ù„Ù…ØµØ­Ù Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ</h2>
<select id="suraSelect"></select>
<div id="quran"></div>
<div id="tooltip" class="tooltip"></div>

<script>
  let dictionary = {};

  // Ø¯Ø§Ù„Ø© Ù„Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ´ÙƒÙŠÙ„ ÙˆØªÙˆØ­ÙŠØ¯ Ø§Ù„Ø­Ø±ÙˆÙ
  function normalize(text) {
    return text
      .replace(/[\u064B-\u065F]/g, "") // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ´ÙƒÙŠÙ„
      .replace(/Ø¥|Ø£|Ø¢/g, "Ø§") // ØªÙˆØ­ÙŠØ¯ Ø§Ù„Ø£Ù„Ù
      .replace(/Ù‰/g, "ÙŠ")
      .replace(/Ø¤/g, "Ùˆ")
      .replace(/Ø¦/g, "ÙŠ")
      .trim();
  }

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¹Ø¬Ù… Ù…Ù† Ù…Ù„Ù Ù…Ø­Ù„ÙŠ
  async function loadDictionary() {
    try {
      const res = await fetch("dictionary.json"); // Ø§Ù„Ù…Ù„Ù Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø¹ index.html
      if (!res.ok) throw new Error("Failed to load dictionary: " + res.status);
      const rawDict = await res.json();
      for (const [key, val] of Object.entries(rawDict)) {
        dictionary[normalize(key)] = val;
      }
      console.log("Dictionary loaded:", dictionary);
    } catch (err) {
      console.error("Error loading dictionary:", err);
    }
  }

  // ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙˆØ±
  async function loadSurasList() {
    try {
      const res = await fetch("https://api.quran.com/api/v4/chapters");
      const data = await res.json();
      const select = document.getElementById("suraSelect");
      data.chapters.forEach(ch => {
        const option = document.createElement("option");
        option.value = ch.id;
        option.textContent = `${ch.id}. ${ch.name_arabic}`;
        select.appendChild(option);
      });
      // Ø¹Ù†Ø¯ Ø§Ù„ØªØºÙŠÙŠØ± â†’ Ø­Ù…Ù‘Ù„ Ø§Ù„Ø³ÙˆØ±Ø©
      select.addEventListener("change", () => {
        loadVerse(select.value);
      });
    } catch (err) {
      console.error("Error loading suras list:", err);
    }
  }

  // ØªØ­Ù…ÙŠÙ„ Ø³ÙˆØ±Ø©
  async function loadVerse(sura = 1) {
    const container = document.getElementById("quran");
    container.innerHTML = "";

    try {
      const res = await fetch(`https://api.quran.com/api/v4/verses/by_chapter/${sura}?language=ar&words=false&translations=false&fields=text_uthmani`);
      if (!res.ok) throw new Error("Failed to load Quran text: " + res.status);
      const data = await res.json();

      data.verses.forEach(v => {
        const verseDiv = document.createElement("div");
        verseDiv.className = "verse";

        v.text_uthmani.split(" ").forEach(word => {
          const span = document.createElement("span");
          span.className = "word";
          span.textContent = word + " ";
          span.addEventListener("click", (event) => {
            showMeaning(word, event);
            event.stopPropagation(); // Ù…Ù†Ø¹ Ø§Ù†ØªØ´Ø§Ø± Ø§Ù„Ø¶ØºØ· Ù„Ø¨Ø§Ù‚ÙŠ Ø§Ù„ØµÙØ­Ø©
          });
          verseDiv.appendChild(span);
        });

        const ayahNum = document.createElement("span");
        ayahNum.className = "ayah-num";
        ayahNum.textContent = ` ï´¿${v.verse_number}ï´¾ `;
        verseDiv.appendChild(ayahNum);

        container.appendChild(verseDiv);
      });
    } catch (err) {
      console.error("Error loading Quran:", err);
    }
  }

  // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ù†Ù‰
  function showMeaning(word, event) {
    const tooltip = document.getElementById("tooltip");
    const normalized = normalize(word);
    const meaning = dictionary[normalized] || "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø¹Ù†Ù‰";

    tooltip.textContent = word + " : " + meaning;
    tooltip.style.left = event.pageX + "px";
    tooltip.style.top = event.pageY + "px";
    tooltip.style.display = "block";
  }

  // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªÙˆÙ„ØªÙŠØ¨ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· ÙÙŠ Ø£ÙŠ Ù…ÙƒØ§Ù† Ø®Ø§Ø±Ø¬ Ø§Ù„ÙƒÙ„Ù…Ø©
  document.addEventListener("click", (e) => {
    const tooltip = document.getElementById("tooltip");
    if (!tooltip.contains(e.target) && !e.target.classList.contains("word")) {
      tooltip.style.display = "none";
    }
  });

  // Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
  loadDictionary().then(() => {
    loadSurasList().then(() => {
      loadVerse(1); // Ø³ÙˆØ±Ø© Ø§Ù„ÙØ§ØªØ­Ø©
      document.getElementById("suraSelect").value = 1;
    });
  });
</script>

</body>
</html>
